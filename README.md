# Описание тестового задания на позицию backend разработчика

## Цель
Нашему отделу пришла задача - считать зону покрытия сотовых вышек. 
- Фронтендерам нужно api для конвертации точек в полигоны с заданным радиусом.
- Аналитикам требуется в реальном времени отсматривать все поступающие запросы в гугл-таблице.

## Задача
Реализовать api-сервис на FastAPI. В нем должен быть метод, который на входе принимает координаты точки в системе EPSG:4326 и радиус в метрах, а на выходе дает GeoJSON с "круглым" полигоном (с соответствующим радиусом и центром в указанных координатах). При каждом вызове метода нужно заносить в гугл-таблицу информацию: дата и время вызова метода, координаты, радиус, площадь покрытия.

## Условия
1. Входящие данные должны валидироваться и оповещает клиент соответствующей ошибкой, если данные не прошли валидацию
2. Сделать имитацию, что это "долгий" запрос (время ответа >5с). При этом вызов с одного клиента не должен блокировать запрос для другого клиента
3. Запросы должны кэшироваться в базу данных postgres. Если запрос повторный - возвращаются данные из кэша без задержки
4. Гугл-таблица создается кандидатом с свободной форме, с настроенным доступом на просмотр.

## Ожидаемый результат
Форк этого репозитория на личном аккаунте github/gitlab кандидата. В нем должно быть описанное выше приложение python, которое будет готово к работе после развертывания виртуального окружения и установки зависимостей. Опционально - подготовить пакет к контейнеризации в docker

## Критерии оценки
Проверяться будет:
- работоспособность и соответствие ТЗ
- общий стиль кода (соблюдение PEP, базовых принципов программирования, документирование кода, наименование переменных и т.д.)

---

## Инструкция по запуску

1. **Создайте файл `.env` в корне проекта** и укажите переменные:
    ```
    POSTGRES_DB=your_db
    POSTGRES_USER=your_user
    POSTGRES_PASSWORD=your_password
    SPREADSHEET_ID=your_google_spreadsheet_id
    ```

2. **Добавьте файл `credentials.json`** (ключ сервисного аккаунта Google) в корень проекта. (Опционально) 

3. **Соберите и запустите сервис через Docker:**
    ```sh
    docker-compose up --build
    ```
---

## Принцип работы модуля

- Сервис реализован на FastAPI.
- Основной endpoint: `/api/convert-to-polygon` — принимает координаты и радиус, возвращает GeoJSON-полигон.
- Все запросы валидируются, кэшируются в Postgres. Повторные запросы возвращаются мгновенно из кэша.
- Вычисления (создание полигона) выполняются через ProcessPoolExecutor — это позволяет обрабатывать несколько запросов параллельно, не блокируя основной поток приложения.
- Имитация "долгого" запроса реализована внутри вычисления (искусственная задержка 5 секунд).
- Информация о каждом запросе (дата, координаты, радиус, площадь) записывается в Google Таблицу.
- Интеграция с Google Sheets реализована через отдельную таску (`background_tasks` FastAPI): запись в таблицу выполняется асинхронно, не влияя на скорость ответа API.

---
